<?php
session_start();

$StoredUsername = "";
$StoredPassword = "";
$LoginResult = "";
// Sezione php dedicata al login
// try {
if (isset($_POST['accedi'])) {
	if (isset($_POST['username'])) {

		$_SESSION['username'] = $_POST['username'];
		$_SESSION['password'] = $_POST['password'];

		$db = new PDO('mysql:host=localhost;dbname=dbnidocellini', 'root', 'mysql231278');
		$db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
		$db->setAttribute(PDO::ATTR_EMULATE_PREPARES, false);


		$query = $db->prepare(
			"SELECT username, password FROM tbuser WHERE username='" . $_SESSION['username'] . "'"
		);
		$query->execute();


		foreach ($query as $key => $value) {
			$StoredUsername = $value[0];
			$StoredPassword = $value[1];
		}
		// $StoredUsername = $query->fetch(PDO::FETCH_ASSOC)['username'];
		// $StoredPassword = $query->fetch(PDO::FETCH_ASSOC)['password'];

		if ($StoredUsername === "") {
			$LoginResult = "Nome utente non trovato!";
		} elseif ($StoredPassword != $_SESSION['password']) {
			$LoginResult = "Password per $StoredUsername errata!";
		} else {
			$LoginResult = "Username: $StoredUsername - Password: $StoredPassword";
			header("Location: Index.html");
		}


	}
}
// } catch (PDOException $e) {
// 	echo ($e->getMessage());
// }


// FINE Sezione php dedicata al login

?>

	<!DOCTYPE html>
	<html>

	<head>
		<title>Login</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="stylesheet" type="text/css" href="DataTables/datatables.css" />
		<link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
		<link rel="stylesheet" type="text/css" href="css/sidebar.css" />
		<link rel="stylesheet" type="text/css" href="css/cellini.css" />
	</head>

	<body>

		<div class="container">


			<form class="form-horizontal" role="form" action="" method="post">
				<div class="row mt-5"></div>
				<div class="row">
					<div class="col-md-3"></div>
					<div class="col-md-6">
						<h2 class="text-center mb-3">Buongiorno!</h2>
						<h6 class="text-center">Per favore inserisci i tuoi dati:</h6>
					</div>
					<div class="col-md-3"></div>
				</div>

				<div class="row mt-1 mb-3">
					<div class="col-lg-3 col-md-2"></div>
					<div class="col-lg-6 col-md-8">
						<label class="sr-only" for="username">Username</label>
						<div class="input-group input-group-lg">
							<input type="text" name="username" class="form-control" id="username" placeholder="Nome profilo" required autofocus>
						</div>
					</div>
					<div class="col-lg-3 col-md-2"></div>
				</div>
				<div class="row mt-3 mb-3">
					<div class="col-lg-3 col-md-2"></div>
					<div class="col-lg-6 col-md-8">

						<label class="sr-only" for="password">Password</label>
						<div class="input-group input-group-lg">
							<input type="password" name="password" class="form-control" style="width: 100px" id="password" placeholder="Password" required
							 autofocus>
						</div>
						<a class="btn-link" href="">Hai dimenticato la password?</a>
						<div class="col-lg-3 col-md-2"></div>
					</div>
				</div>
				<div class="row mt-3 mb-3">
					<div class="col-lg-3 col-md-2"></div>
					<div class="col-lg-6 col-md-8">

						<label class="sr-only" for="accedi">Submit</label>
						<div class="input-group input-group-lg">
							<input type="submit" name="accedi" class="form-control btn btn-outline-primary" style="width: 100px" id="accedi" required
							 autofocus value="Accedi">
						</div>
						<div class="col-lg-3 col-md-2"></div>
					</div>
				</div>
				<div class="row mt-5">
					<div class="col-12">
						<p class="h5 text-center font-weight-bold text-info">OPPURE </p>
					</div>
				</div>
				<div class="row mt-5 mb-3">
					<div class="col-lg-3 col-md-2"></div>
					<div class="col-lg-6 col-md-8">

						<label class="sr-only" for="submit">Submit</label>
						<div class="input-group input-group-lg">

							<input type="submit" name="newuser" class="form-control btn btn-outline-primary" style="width: 100px" id="newuser" required
							 autofocus value="Crea un nuovo utente">
						</div>
						<div class="col-lg-3 col-md-2"></div>
					</div>
				</div>
		</div>
		<!-- <div class="col-md-3"></div>
				</div> -->
		</form>
		</div>
		<p class="font-weight-bold text-danger">
			<?php 
				echo $LoginResult;
			?>
		</p>





		<script src="js/jquery.js"></script>
		<script src="js/bootstrap.bundle.js"></script>
		<script src="DataTables/datatables.js"></script>
		<script src="js/cellini.js"></script>
	</body>

	</html>